<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>KBC + GLB Model Background</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Orbitron', sans-serif; /* Changed font to Orbitron */
            background-color: #002F4F; /* Set a background color since 3D model is removed */
        }

        /* Removed canvas styles as 3D model is removed */

        .quiz-container-wrapper {
            position: absolute;
            top: 0;
            right: 0;
            width: 70%;
            height: 100%;
            background: transparent;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 30px 20px;
            box-shadow: -10px 0 30px rgba(0,0,0,0.4);
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }

        .container {
            display: none;
            flex-direction: row;
            width: 95%;
            max-width: 1200px;
            gap: 20px;
        }

        .welcome-screen {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            color: #fff;
        }

        .welcome-logo {
            font-size: 2em;
            color: gold;
        }

        .start-btn {
            background-color: gold;
            color: black;
            font-size: 1.2em;
            font-weight: bold;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-family: 'Orbitron', sans-serif; /* Applied Orbitron to button */
        }

        .start-btn:hover {
            background-color: #ffd700;
        }

        .game-container {
            background-color: rgba(0,0,0,0.6);
            border-radius: 10px;
            padding: 20px;
            flex: 2;
            box-shadow: 0 0 20px #ffd700;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: #fff;
        }

        .question {
            font-size: 1.5em;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid gold;
            border-radius: 8px;
            background-color: #002b5c;
            color: silver;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-btn {
            background-color: #004080;
            color: #ffffff;
            border: 2px solid gold;
            padding: 15px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            font-family: 'Orbitron', sans-serif; /* Applied Orbitron to button */
        }

        .option-btn:hover {
            background-color: #0059b3;
        }

        .option-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            background-color: gold;
            color: black;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            flex: 1;
            transition: background-color 0.3s ease;
            font-family: 'Orbitron', sans-serif; /* Applied Orbitron to button */
        }

        .action-btn:hover {
            background-color: #ffd700;
        }

        .action-btn:disabled {
            background-color: gray;
            cursor: not-allowed;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1.2em;
            color: #ffd700;
        }

        .final-congrats {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            color: gold;
            padding: 20px;
        }

        .final-badge {
            font-size: 1.5em;
            font-weight: bold;
            background-color: gold;
            color: black;
            padding: 15px 30px;
            border-radius: 12px;
            border: 3px solid white;
            margin-top: 20px;
        }

        .instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #ffd700;
            font-size: 0.9em;
            z-index: 20;
        }
    </style>

    <!-- Removed importmap for Three.js as 3D model is no longer used -->
</head>
<body>

    <!-- Removed Three.js script block as 3D model is no longer used -->

    <div class="quiz-container-wrapper">
        <div class="welcome-screen" id="welcome-screen">
            <div class="welcome-logo">üåü KBC - Gen AI & Tech Edition</div>
            <button class="start-btn" onclick="startGame()">‚ñ∂Ô∏è Start Game</button>
        </div>

        <div class="container" id="game-container">
            <div class="game-container">
                <div class="top-bar">
                    <div id="timer">‚è±Ô∏è 30s</div>
                </div>
                <div class="question" id="question">Loading...</div>
                <div class="options" id="options"></div>
                <div class="actions">
                    <button class="action-btn" onclick="restartGame()">üîÅ Restart</button>
                    <button class="action-btn" onclick="quitGame()">üö™ Quit</button>
                </div>
            </div>
        </div>
    </div>

    <div class="instructions">
        <div>If you are using PC/Laptop:</div>
        <div>Press 'N' after answering a question to proceed to the next one.</div>
        <div>If you are using mobile:</div>
        <div>Tap the 'Next Question' area (where the question would be) after answering to proceed.</div>
    </div>

    <!-- Audio elements -->
    <audio id="soundQuestion" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
    <audio id="soundCorrect" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
    <audio id="soundWrong" src="audio/squid-game-gunshot.mp3" preload="auto"></audio>
    <!-- Removed doll-specific audio elements -->
    <audio id="soundIntro" src="audio/squid-game-rules.mp3" preload="auto"></audio>

    <script>
        // Array of questions for the quiz
        const allQuestions = [
            { q: "Which company developed GPT-4?", a: ["Google", "OpenAI", "Meta", "IBM"], c: 1 },
            { q: "What does AI stand for?", a: ["Automated Input", "Artificial Intelligence", "Advanced Interface", "Analog Input"], c: 1 },
            { q: "Primary language for TensorFlow?", a: ["Java", "C++", "Python", "Ruby"], c: 2 },
            { q: "Purpose of GPU in AI?", a: ["Power", "Rendering", "Parallel processing", "Memory"], c: 2 },
            { q: "Facebook AI framework?", a: ["Keras", "Theano", "PyTorch", "CNTK"], c: 2 },
            { q: "NLP stands for?", a: ["Neural LP", "Natural Language Processing", "Net Language Python", "None"], c: 1 },
            { q: "Image recognition model?", a: ["CNN", "RNN", "GAN", "MLP"], c: 0 },
            { q: "Google's AI assistant?", a: ["Alexa", "Siri", "Google Assistant", "Bixby"], c: 2 },
            { q: "Non ML type?", a: ["Supervised", "Reinforcement", "Sequential", "Unsupervised"], c: 2 },
            { q: "Activation function use?", a: ["Normalize", "Overfit", "Initialize", "Non-linearity"], c: 3 },
            { q: "BERT by?", a: ["IBM", "Google", "Meta", "Amazon"], c: 1 },
            { q: "GAN stands for?", a: ["Graphical AI Network", "General Adv Network", "Generative Adversarial Network", "Generic AI Node"], c: 2 }
        ];

        let questions, currentIndex = 0, timer, timeLeft = 30;
        let quizActive = false;
        let waitingForNextQuestionNKey = false; // Flag for waiting for 'N' key after an answer

        // DOM elements
        const questionEl = document.getElementById("question");
        const optionsEl = document.getElementById("options");
        const timerEl = document.getElementById("timer");
        const soundCorrect = document.getElementById("soundCorrect");
        const soundWrong = document.getElementById("soundWrong");
        const soundQuestion = document.getElementById("soundQuestion");
        const soundIntro = document.getElementById("soundIntro");

        // Global game controller, accessible by other parts if needed (simplified)
        window.gameController = {
            // Displays a message indicating the doll is turning (now just a placeholder message)
            showDollSeeingMessage: function() {
                questionEl.textContent = "Get ready for the question...";
                optionsEl.innerHTML = "";
                clearInterval(timer); // Stop any active timer
                timerEl.textContent = "";
            },

            // Loads the next question (no doll animation involved anymore)
            loadQuestionAfterDoll: function() {
                // This function is now directly called by initializeGameForQuestion or triggerNextQuestion
                // No doll-specific waiting logic here.
                loadQuestion();
            },

            // Triggers the next question after 'N' key press or touch
            triggerNextQuestion: function() {
                if (waitingForNextQuestionNKey) {
                    waitingForNextQuestionNKey = false; // Reset the flag
                    currentIndex++; // Move to the next question
                    // If we've exhausted all unique questions, reset currentIndex to 0 to loop
                    if (currentIndex >= questions.length) {
                        currentIndex = 0;
                        // Optionally, reshuffle here if you want a new random order after a full cycle
                        questions = [...allQuestions].sort(() => 0.5 - Math.random());
                    }

                    window.gameController.showDollSeeingMessage(); // Show a brief message
                    setTimeout(window.gameController.loadQuestionAfterDoll, 1500); // Load question after a short delay
                }
            },
            waitingForNextQuestionNKey: waitingForNextQuestionNKey // Expose state for external access
        };

        // Initializes game state and starts the first question
        const initializeGameForQuestion = () => {
            // Reset game state for a new round of questions
            questions = [...allQuestions].sort(() => 0.5 - Math.random()); // Shuffle questions
            currentIndex = 0;
            quizActive = true;
            waitingForNextQuestionNKey = false; // Reset this state

            // Clear any active timers from a previous game
            clearInterval(timer);
            timerEl.textContent = ""; // Clear timer display

            // Directly load the first question after a short delay
            questionEl.textContent = "Get ready for the first question...";
            optionsEl.innerHTML = "";
            setTimeout(loadQuestion, 1500); // Load question directly
        };

        // Starts the game from the welcome screen
        function startGame() {
            document.getElementById("welcome-screen").style.display = "none";
            document.getElementById("game-container").style.display = "flex";

            // Display "Rules" immediately when game starts and intro sound plays
            questionEl.textContent = "üîä Rules...";
            optionsEl.innerHTML = ""; // Clear options while rules are playing

            if (soundIntro) {
                soundIntro.currentTime = 0; // Ensure it starts from the beginning

                // Remove any existing 'ended' listeners before adding a new one to prevent multiple calls
                soundIntro.removeEventListener('ended', handleIntroEnded);

                // Add a named event listener for when the intro sound ends
                function handleIntroEnded() {
                    console.log("Intro audio ended. Initializing game for questions.");
                    // Remove the listener after it fires to prevent multiple calls
                    soundIntro.removeEventListener('ended', handleIntroEnded);

                    // Directly initialize game after the audio ends
                    initializeGameForQuestion();
                }
                soundIntro.addEventListener('ended', handleIntroEnded);

                // Attempt to play the intro sound
                soundIntro.play()
                    .then(() => {
                        console.log("Intro audio started playing.");
                    })
                    .catch(error => {
                        console.warn("Intro audio play failed (could be blocked even after click, or other error):", error);
                        // Fallback: If audio fails to play, still proceed with the game after a short delay
                        soundIntro.removeEventListener('ended', handleIntroEnded); // Remove listener if play fails
                        initializeGameForQuestion(); // Directly initialize game if audio fails
                    });
            } else {
                console.warn("soundIntro audio element not found. Proceeding without intro sound.");
                initializeGameForQuestion(); // Directly initialize game if no intro sound
            }
        }

        // Loads a question into the display
        function loadQuestion() {
            clearInterval(timer); // Clear any existing timer

            const q = questions[currentIndex];
            timeLeft = 30; // Reset timer for new question
            updateTimer();
            timer = setInterval(() => {
                timeLeft--;
                updateTimer();
                if (timeLeft <= 0) endGame("‚è±Ô∏è Time's up!"); // End game if time runs out
            }, 1000);

            questionEl.textContent = q.q; // Display the question
            optionsEl.innerHTML = ""; // Clear previous options

            soundQuestion.currentTime = 0;
            soundQuestion.play().catch(() => {}); // Play question sound

            // Create option buttons
            q.a.forEach((option, i) => {
                const btn = document.createElement("button");
                btn.className = "option-btn";
                btn.textContent = option;
                btn.onclick = () => handleAnswer(i); // Attach click handler
                optionsEl.appendChild(btn);
            });
        }

        // Handles user's answer
        function handleAnswer(i) {
            clearInterval(timer); // Stop the timer
            const correct = questions[currentIndex].c; // Get correct answer index
            const btns = optionsEl.querySelectorAll("button");

            // Disable all options and highlight correct/incorrect
            btns.forEach((btn, index) => {
                btn.disabled = true;
                if (index === correct) {
                    btn.style.backgroundColor = "#28a745"; // Green for correct
                } else if (index === i) {
                    btn.style.backgroundColor = "#dc3545"; // Red for incorrect
                }
            });

            // Play appropriate sound
            if (i === correct) {
                soundCorrect.currentTime = 0;
                soundCorrect.play().catch(() => {});
            } else {
                soundWrong.currentTime = 0;
                soundWrong.play().catch(() => {});
            }

            // After feedback, wait for 'N' key press for the next question
            waitingForNextQuestionNKey = true;
            questionEl.textContent = "Press 'N' for the next question...";
            optionsEl.innerHTML = ""; // Clear options
            timerEl.textContent = ""; // Clear timer display
        }

        // Updates the timer display
        function updateTimer() {
            timerEl.textContent = `‚è±Ô∏è ${timeLeft}s`;
        }

        // Ends the game and displays a message
        function endGame(msg) {
            clearInterval(timer);
            questionEl.textContent = msg;
            optionsEl.innerHTML = "";
            timerEl.textContent = "";
            quizActive = false;
            waitingForNextQuestionNKey = false; // Reset this flag
        }

        // Restarts the game
        function restartGame() {
            initializeGameForQuestion();
        }

        // Quits the game
        function quitGame() {
            endGame("üö™ You have quit the game. Better luck next time, player!"); // Updated quit message
        }

        // Handle mobile touch for 'Next Question'
        document.addEventListener("touchstart", function(event) {
            const quizArea = document.querySelector('.quiz-container-wrapper');
            // Handle touch for 'Next Question' if waiting for N key and touch is outside quiz area
            if (!quizArea.contains(event.target) && window.gameController.waitingForNextQuestionNKey) {
                window.gameController.triggerNextQuestion();
            }
        });

        // Keyboard event listener for 'N'
        window.addEventListener('keydown', (event) => {
            // Trigger next question
            if (event.key.toLowerCase() === 'n' && window.gameController.waitingForNextQuestionNKey) {
                window.gameController.triggerNextQuestion();
            }
        });
    </script>
</body>
</html>
